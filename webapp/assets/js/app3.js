let array = [
    {
        image: "#8257F6",
        fontFamily: "'Nanum Myeongjo', serif",
        review: "빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강",
        userName: "mark",
        rn: 1,
        id: "a1"
    },
    {
        image: "#34293C",
        fontFamily: "'Nanum Brush Script', cursive",
        review: "주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황.",
        userName: "lisha",
        rn: 2,
        id: "a2"
    },
    {
        image: "#31A848",
        fontFamily: "'Do Hyeon', sans-serif",
        review: "노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑",
        userName: "nadan",
        rn: 3,
        id: "a3"
    },
    {
        image: "#3623C9",
        fontFamily: "'Nanum Myeongjo', serif",
        review: "초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록초록",
        userName: "doyoung",
        rn: 4,
        id: "a4"
    },
    {
        image: "blue",
        fontFamily: "'Nanum Brush Script', cursive",
        review: "파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑파랑",
        userName: "doyoung",
        rn: 5,
        id: "a5"
    },
    {
        image: "navy",
        fontFamily: "'Do Hyeon', sans-serif",
        review: "남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색남색",
        userName: "seohyun",
        rn: 6,
        id: "a6"
    },
    {
        image: "purple",
        fontFamily: "'Nanum Myeongjo', serif",
        review: "보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라보라",
        userName: "coly",
        rn: 7,
        id: "a7"
    },
    {
        image: "red",
        fontFamily: "'Nanum Brush Script', cursive",
        review: "빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강빨강",
        userName: "doyoung",
        rn: 8,
        id: "a8"
    },
    {
        image: "orange",
        fontFamily: "'Do Hyeon', sans-serif",
        review: "주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황주황.",
        userName: "cozy",
        rn: 9,
        id: "a9"
    }
    ,    {
        image: "yellow",
        fontFamily: "'Nanum Myeongjo', serif",
        review: "노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑노랑",
        userName: "doyoung",
        rn: 10,
        id: "a10"
    }
];

let songs = [
    {
        title: "늑대와 미녀",
        singer: "엑소"
    },{
        title: "호랑이",
        singer: "수퍼엠"
    },{
        title: "슈가프리",
        singer: "티아라"
    },{
        title: "intention",
        singer: "찰리 푸스"
    },{
        title: "알콜프리",
        singer: "트와이스"
    },{
        title: "롤리폴리",
        singer: "티아라"
    },{
        title: "DNA",
        singer: "방탄소년단"
    },{
        title: "롤리팝",
        singer: "2NE1"
    }
]

const container = document.querySelector(".container");
const slideContainer = document.querySelector(".slide-container");
const upBtn = document.querySelector(".upBtn");
const downBtn = document.querySelector(".downBtn");
const autoModeBtn = document.querySelector(".autoModeBtn");
const closeBtn = document.querySelector(".close-btn");
const sideBar = document.querySelector(".sidebar");
const sidebarToggle = document.querySelector(".fa-bars");
let navLinks = document.querySelector(".links")
let sidebarBtn = document.querySelector(".sidebarBtn")
let bgmPrevBtn = document.querySelector(".prevArrow")
let bgmNextBtn = document.querySelector(".nextArrow")
let singer = document.querySelector(".singer")
let songTitle = document.querySelector(".song-title")
let bgmPagination = document.querySelector(".bgm-pagination")
let emoTags = document.querySelectorAll(".emoTag")
let randomCheckBtn = document.querySelector(".randomCheckBtn")
let dim = document.querySelector(".dim")
const playlistStatic = document.querySelector(".static")
const playlistAddModal = document.querySelector(".playlistAddModal")
const modalCloseBtn = document.querySelector(".modal-closeBtn")
const addReviewModal = document.querySelector(".addReviewModal")
const reviewModalCloseBtn = addReviewModal.querySelector(".modal-closeBtn")
const reviewAddBtns = addReviewModal.querySelectorAll(".reviewAddBtn")

let counter = 0;
let slides;
let seconds = 4000;
let interval
let autoToggle = true;
let bgmCounter = 0;
let modeToggle = false;
let heartToggle = false;

// 서평 플레이리스트에 추가 : 아이콘 토글 
for(let addBtn of reviewAddBtns) {
    addBtn.onclick = function(e){
        let classlist = e.path[0].classList

        if(classlist[1] == 'fa-plus') {
            addBtn.innerHTML = '<i class="fa-solid fa-check"></i>'
        } else {
            addBtn.innerHTML = '<i class="fa-solid fa-plus"></i>'
        }
    }
}

reviewModalCloseBtn.onclick = function() {
    addReviewModal.classList.remove("show-modal")
}

modalCloseBtn.onclick = function(){
    playlistAddModal.classList.remove("show-modal")
}

playlistStatic.onclick = function(){
    playlistAddModal.classList.toggle('show-modal')
}

bgmPrevBtn.addEventListener("click", function(){
    
    if(bgmCounter > 0) {
        bgmCounter--

        updatePaging()
    } else {
        bgmCounter = songs.length - 1

        updatePaging()
    }
})

bgmNextBtn.addEventListener("click", function(){

    if(bgmCounter < songs.length - 1) {
        bgmCounter++

        updatePaging()        
    } else {
        bgmCounter = 0

        updatePaging() 
    }

})

sidebarToggle.addEventListener("click", function() {
    sideBar.classList.toggle("show-sidebar");
    dim.classList.add("show-dim")
})

closeBtn.addEventListener("click", function() {
    sideBar.classList.remove("show-sidebar");
    dim.classList.remove("show-dim")
})

upBtn.addEventListener("click", function(){
    counter--;
    carousel();
})

downBtn.addEventListener("click", function(){
    counter++;
    carousel();
})

autoModeBtn.onclick = function(){
    changeMode()
}

window.addEventListener("keydown", function(e) {
    if(e.key == 'ArrowUp') {
        counter--;
        carousel();
    }
})

window.addEventListener("keydown", function(e) {
    if(e.key == 'ArrowDown') {
        counter++;
        carousel();
    }
})

window.addEventListener("DOMContentLoaded", function(){
    console.log("loaded...")

    autoCarousel()
})


window.addEventListener("keydown", function(e){ 
    if(e.key == 'Enter') {
        changeMode()
    }
})

/*** 감정 태그에 toggle 기능 주기 ***/
for(let emoTag of emoTags) {
    emoTag.onclick = function(e) {
        emoTag.classList.toggle("checked")
    }
}

/*** 랜덤 체크 버튼에 toggle 기능 주기 ***/
randomCheckBtn.onclick = function(e) {
    let classList = e.path[0].classList
    
    if(classList[1] == 'fa-check') {
        randomCheckBtn.innerHTML = '<i class="fa-solid fa-circle-check"></i>'
    } else {
        randomCheckBtn.innerHTML = '<i class="fa-solid fa-check"></i>'
    }
}

function changeMode(){
    if(modeToggle == true) { // 자동 전환 모드
        console.log("auto toggle true")

        autoCarousel()

        modeToggle = !modeToggle
    } else {                // 수동 전환 모드
        console.log("auto toggle false")

        clearInterval(interval)

        // if(counter > 0) {
        //     upBtn.style.display = "block";
        // } else {
        //     upBtn.style.display = "none";
        // }
        // downBtn.style.display = "block"

        navLinks.style.visibility = 'visible'
        sidebarBtn.style.visibility = 'visible'
        autoModeBtn.style.display = 'block'

        modeToggle = !modeToggle

        carousel()
    }
}

function autoCarousel(){
    
    upBtn.style.display = "none";
    downBtn.style.display = "none";
    autoModeBtn.style.display = 'none';

    navLinks.style.visibility = 'hidden'
    sidebarBtn.style.visibility = 'hidden'

    interval = setInterval(
        function(){
            counter++
            carousel()
        },
        4000
    )
    
}

function carousel() {
    console.log("counter: " + counter)

    if(counter == slides.length) {
        renderNewArray(array);
    }

    if(modeToggle === true) {
        if(counter > 0) {
            upBtn.style.display = "block";
        } else {
            upBtn.style.display = "none";
        }
        downBtn.style.display = "block"        
    }

    slides.forEach(slide => {
        slide.style.transform = `translateY(-${counter * 100}%)`;
    })
}

function render(item) {

    const slide = document.createElement("div");
    const review = document.createElement("p");
    const username = document.createElement("p");
    const btnContainer = document.createElement("div");
    const heartBtn = document.createElement("button");
    const addBtn = document.createElement("button");

    slide.classList.add("slide");
    btnContainer.classList.add("btn-container");

    slide.onclick = function(){
        clearInterval(interval)
    }

    review.textContent = item.review;
    username.textContent = item.userName;
    slide.style.backgroundColor = `${item.image}`
    heartBtn.innerHTML = '좋아요<i class="fa-regular fa-heart"></i>';
    addBtn.innerHTML = '플레이리스트<i class="fa-solid fa-plus"></i>';

    heartBtn.onclick = function(e){
        console.log("좋아요")

        if(heartToggle === false) {
            heartBtn.innerHTML = '좋아요<i class="fa-solid fa-heart"></i>'
        } else {
            heartBtn.innerHTML = '좋아요<i class="fa-regular fa-heart"></i>'
        }

        heartToggle = !heartToggle
    }

    addBtn.onclick = function(){
        addReviewModal.classList.toggle("show-modal")
    }

    review.classList.add("review");
    username.classList.add("username");
    btnContainer.classList.add("slideBtnContainer");
    heartBtn.classList.add("heartBtn");
    addBtn.classList.add("addBtn");

    review.style.fontFamily = item.fontFamily;

    btnContainer.append(heartBtn, addBtn);
    slide.append(review, username, btnContainer);
    
    slideContainer.append(slide)
    container.append(slideContainer);
}

function updatePaging() {
    singer.textContent = songs[bgmCounter].singer
    songTitle.textContent = songs[bgmCounter].title

    // 해당 페이지 위치를 페이징에 반영하기
    let dots = document.querySelectorAll(".dot");

    for(let dot of dots) {
        dot.classList.remove("active")
    }

    dots[bgmCounter].classList.add("active")
}

function renderBgmPaging(count) {

    let ul = document.createElement("ul")

    for(let index = 0; index < count; index++){
        let div = document.createElement("div")
        let li = document.createElement("li")

        div.classList.add("dot")
        if(index == bgmCounter) {
            div.classList.add("active")
        }

        li.append(div)
        ul.append(li)
    }

    bgmPagination.append(ul)
}

function renderNewArray(array) {
    for(let item of array) {
        render(item)
    }

    slides = document.querySelectorAll(".slide")

    slides.forEach((slide, index) => {
        slide.style.top = `${index * 100}%`;
    })
}

function init() {
    /*** 서평 슬라이드 화면 출력 및 나열 ***/
    renderNewArray(array)

    upBtn.style.display = "none";

    /*** sidebar bgm 정보 넣기 ***/
    singer.textContent = songs[bgmCounter].singer
    songTitle.textContent = songs[bgmCounter].title

    /*** sidebar bgm pagination 화면 출력하기 ***/
    let songsCnt = songs.length;

    renderBgmPaging(songsCnt)

}

init();